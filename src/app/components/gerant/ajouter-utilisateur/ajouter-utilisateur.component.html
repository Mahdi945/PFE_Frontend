<app-navbar></app-navbar>
<app-sidebar></app-sidebar>

<main id="main" class="main">
  <div class="pagetitle">
    <h2 style="color: rgb(7, 7, 128);">Ajouter un utilisateur</h2>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html"><i class="bi bi-house-door"></i></a></li>
        <li class="breadcrumb-item">Gestion des utilisateurs</li>
        <li class="breadcrumb-item active">Ajouter un utilisateur</li>
      </ol>
    </nav>
  </div>

  <!-- Formulaire d'ajout d'utilisateur -->
  <form class="row g-3 p-4 shadow-sm bg-white rounded" (ngSubmit)="onSubmit()" #userForm="ngForm">
    <div class="col-12">
      <label for="username" class="form-label fw-bold">Nom d'utilisateur</label>
      <input type="text" class="form-control" id="username" name="username" [(ngModel)]="user.username" required minlength="3" maxlength="50">
    </div>

    <div class="col-12">
      <label for="email" class="form-label fw-bold">Email</label>
      <input type="email" class="form-control" id="email" name="email" [(ngModel)]="user.email" required email>
    </div>

    <div class="col-12">
      <label for="numero_telephone" class="form-label fw-bold">Numéro de téléphone</label>
      <input type="text" class="form-control" id="numero_telephone" name="numero_telephone" [(ngModel)]="user.numero_telephone" required pattern="^[0-9]{8,}$">
    </div>

    <div class="col-12">
      <label for="password" class="form-label fw-bold">Mot de passe</label>
      <input type="password" class="form-control" id="password" name="password" [(ngModel)]="user.password" required minlength="6" maxlength="20">
    </div>
    
    <div class="col-12">
      <label for="role" class="form-label fw-bold">Rôle</label>
      <select class="form-control" id="role" name="role" [(ngModel)]="user.role" required>
        <option value="" disabled selected>Choisissez un rôle</option>
        <option value="cogerant">Cogerant</option>
        <option value="client">client</option>
        <option value="caissier">caissier</option>
        <option value="pompiste">pompiste</option>
      </select>
      <div *ngIf="userForm.controls['role']?.invalid && userForm.controls['role']?.touched" class="text-danger">
        Veuillez sélectionner un rôle.
      </div>
    </div>

    <!-- Affichage des erreurs -->
    <div *ngIf="errorMessage" class="alert alert-danger mt-3 text-center">
      <strong>Erreur :</strong> {{ errorMessage }}
    </div>

    <div class="text-center d-flex justify-content-center gap-3 mt-4">
        <button type="reset" class="btn btn-secondary px-4">Vider</button>
      <button type="submit" class="btn btn-primary px-4" [disabled]="userForm.invalid">Valider</button>
    
    </div>
  </form>

  <!-- Modal de confirmation -->
  <div *ngIf="showConfirmationBox" class="modal fade show" tabindex="-1" style="display: block;" id="confirmationModal" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmationModalLabel">Confirmer l'ajout</h5>
          <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Êtes-vous sûr de vouloir ajouter cet utilisateur ?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Annuler</button>
          <button type="button" class="btn btn-primary" (click)="confirmUserAddition()">Confirmer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Message de succès -->
  <div *ngIf="showSuccessBox" class="success-box text-center">
    <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
    <h4>Utilisateur ajouté avec succès !</h4>
  </div>
</main>
  <app-footer></app-footer>


<a href="#" class="back-to-top d-flex align-items-center justify-content-center">
  <i class="bi bi-arrow-up-short"></i>
</a>

<!-- Script pour gérer Bootstrap Modal -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
