<app-navbar></app-navbar>
<app-sidebar></app-sidebar>
<main id="main" class="main">
  <div class="container">
    <div class="pagetitle d-flex justify-content-between align-items-center">
      <h2 style="color: rgb(7, 7, 128);">Liste des utilisateurs</h2>
      <!-- Bouton Ajouter Utilisateur -->
      <a routerLink="/ajouter-utilisateur" class="btn btn-success">
        <i class="bi bi-person-plus"></i> Ajouter Utilisateur
      </a>
    </div>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html"><i class="bi bi-house-door"></i></a></li>
        <li class="breadcrumb-item">Gestion des utilisateurs</li>
        <li class="breadcrumb-item active">Liste des utilisateurs</li>
      </ol>
    </nav>

    <!-- Champs de recherche -->
    <div class="search-filter">
      <input type="text" [(ngModel)]="searchTerm" (input)="filterUsers()" placeholder="Rechercher par email, téléphone, username" class="form-control"> <br>
      <select [(ngModel)]="filterRole" (change)="filterUsers()" class="form-select">
        <option value="">Tous</option>
        <option value="client">Client</option>
        <option value="caissier">Caissier</option>
        <option value="pompiste">Pompiste</option>
      </select>
    </div> <br>

    <!-- Tableau des utilisateurs -->
    <table class="table">
      <thead>
        <tr>
         
          <th>Photo</th>
          <th>Nom d'utilisateur</th>
          <th>Email</th>
          <th>Téléphone</th>
          <th>Rôle</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers">
          
            <td>
                <div class="user-photo-container">
                  <img *ngIf="user.photo" [src]=" user.photo" alt="Photo" class="user-photo">
                  <div *ngIf="!user.photo" class="default-icon">
                    <i class="bi bi-person-circle"></i>  <!-- Icône par défaut -->
                  </div>
                </div>
              </td>
              
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.numero_telephone }}</td>
          <td>{{ user.role }}</td>
          <td>
            <button class="btn btn-primary" (click)="openModal(user)">Modifier</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</main>

<!-- Modal personnalisé -->
<div *ngIf="isModalOpen" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" style="color: rgb(7, 7, 128);">Modifier l'utilisateur</h5>
      <button class="btn-close" (click)="closeModal()">X</button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="updateUser()">
        <div class="form-group mb-3">
          <label for="username">Nom d'utilisateur :</label>
          <input type="text" id="username" [(ngModel)]="selectedUser.username" name="username" class="form-control" required>
        </div>
        <div class="form-group mb-3">
          <label for="email">Email :</label>
          <input type="email" id="email" [(ngModel)]="selectedUser.email" name="email" class="form-control" required>
        </div>
        <div class="form-group mb-3">
          <label for="numero_telephone">Numéro de téléphone :</label>
          <input type="text" id="numero_telephone" [(ngModel)]="selectedUser.numero_telephone" name="numero_telephone" class="form-control" required>
        </div>
        <div class="form-group mb-3">
          <label for="role">Rôle :</label>
          <select id="role" [(ngModel)]="selectedUser.role" name="role" class="form-control" required>
            <option value="cogerant">Cogerant</option>
            <option value="client">Client</option>
            <option value="caissier">Caissier</option>
            <option value="pompiste">Pompiste</option>
          </select>
        </div>
        <div class="d-flex justify-content-end mt-3">
          <button type="submit" class="btn btn-primary">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>
</div>

<app-footer></app-footer>
<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
